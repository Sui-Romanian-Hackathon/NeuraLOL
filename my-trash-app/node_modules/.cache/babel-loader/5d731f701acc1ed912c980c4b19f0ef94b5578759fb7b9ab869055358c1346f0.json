{"ast":null,"code":"import { ClientCache } from \"../../experimental/cache.js\";\nimport { MvrClient } from \"../../experimental/mvr.js\";\nimport { findNamesInTransaction, replaceNames } from \"../../experimental/mvr.js\";\nconst cacheMap = /* @__PURE__ */new WeakMap();\nconst namedPackagesPlugin = options => {\n  let mvrClient;\n  if (options) {\n    const overrides = options.overrides ?? {\n      packages: {},\n      types: {}\n    };\n    if (!cacheMap.has(overrides)) {\n      cacheMap.set(overrides, new ClientCache());\n    }\n    mvrClient = new MvrClient({\n      cache: cacheMap.get(overrides),\n      url: options.url,\n      pageSize: options.pageSize,\n      overrides\n    });\n  }\n  return async (transactionData, buildOptions, next) => {\n    const names = findNamesInTransaction(transactionData);\n    if (names.types.length === 0 && names.packages.length === 0) {\n      return next();\n    }\n    const resolved = await (mvrClient || getClient(buildOptions).core.mvr).resolve({\n      types: names.types,\n      packages: names.packages\n    });\n    replaceNames(transactionData, resolved);\n    await next();\n  };\n};\nfunction getClient(options) {\n  if (!options.client) {\n    throw new Error(`No sui client passed to Transaction#build, but transaction data was not sufficient to build offline.`);\n  }\n  return options.client;\n}\nexport { getClient, namedPackagesPlugin };","map":{"version":3,"names":["ClientCache","MvrClient","findNamesInTransaction","replaceNames","cacheMap","WeakMap","namedPackagesPlugin","options","mvrClient","overrides","packages","types","has","set","cache","get","url","pageSize","transactionData","buildOptions","next","names","length","resolved","getClient","core","mvr","resolve","client","Error"],"sources":["/Users/joitafabian/Documents/Hackathon/my-trash-app/node_modules/@mysten/sui/src/transactions/plugins/NamedPackagesPlugin.ts"],"sourcesContent":["// Copyright (c) Mysten Labs, Inc.\n// SPDX-License-Identifier: Apache-2.0\n\nimport { ClientCache } from '../../experimental/cache.js';\nimport { MvrClient } from '../../experimental/mvr.js';\nimport type { BuildTransactionOptions } from '../resolve.js';\nimport type { TransactionDataBuilder } from '../TransactionData.js';\nimport { findNamesInTransaction, replaceNames } from '../../experimental/mvr.js';\nimport type { NamedPackagesOverrides } from '../../experimental/mvr.js';\n\nexport type NamedPackagesPluginOptions = {\n\t/**\n\t * The URL of the MVR API to use for resolving names.\n\t */\n\turl: string;\n\t/**\n\t * The number of names to resolve in each batch request.\n\t * Needs to be calculated based on the GraphQL query limits.\n\t */\n\tpageSize?: number;\n\t/**\n\t * Local overrides for the resolution plugin. Pass this to pre-populate\n\t * the cache with known packages / types (especially useful for local or CI testing).\n\t *\n\t * The type cache expects ONLY first-level types to ensure the cache is more composable.\n\t *\n\t * \tExpected format example:\n\t *  {\n\t * \t\tpackages: {\n\t * \t\t\t'@framework/std': '0x1234',\n\t * \t\t},\n\t * \t\ttypes: {\n\t * \t\t\t'@framework/std::string::String': '0x1234::string::String',\n\t * \t\t},\n\t * \t}\n\t *\n\t */\n\toverrides?: NamedPackagesOverrides;\n};\n\n// The original versions of the mvr plugin cached lookups by mutating overrides.\n// We don't want to mutate the options, but we can link our cache to the provided overrides object\n// This preserves the caching across transactions while removing the mutation side effects\nconst cacheMap = new WeakMap<object, ClientCache>();\n\n/**\n * @experimental This plugin is in experimental phase and there might be breaking changes in the future\n *\n * Adds named resolution so that you can use .move names in your transactions.\n * e.g. `@org/app::type::Type` will be resolved to `0x1234::type::Type`.\n * This plugin will resolve all names & types in the transaction block.\n *\n * To install this plugin globally in your app, use:\n * ```\n * Transaction.registerGlobalSerializationPlugin(\"namedPackagesPlugin\", namedPackagesPlugin({ suiGraphQLClient }));\n * ```\n *\n * You can also define `overrides` to pre-populate name resolutions locally (removes the GraphQL request).\n */\nexport const namedPackagesPlugin = (options?: NamedPackagesPluginOptions) => {\n\tlet mvrClient: MvrClient | undefined;\n\n\tif (options) {\n\t\tconst overrides = options.overrides ?? {\n\t\t\tpackages: {},\n\t\t\ttypes: {},\n\t\t};\n\n\t\tif (!cacheMap.has(overrides)) {\n\t\t\tcacheMap.set(overrides, new ClientCache());\n\t\t}\n\n\t\tmvrClient = new MvrClient({\n\t\t\tcache: cacheMap.get(overrides)!,\n\t\t\turl: options.url,\n\t\t\tpageSize: options.pageSize,\n\t\t\toverrides: overrides,\n\t\t});\n\t}\n\n\treturn async (\n\t\ttransactionData: TransactionDataBuilder,\n\t\tbuildOptions: BuildTransactionOptions,\n\t\tnext: () => Promise<void>,\n\t) => {\n\t\tconst names = findNamesInTransaction(transactionData);\n\n\t\tif (names.types.length === 0 && names.packages.length === 0) {\n\t\t\treturn next();\n\t\t}\n\n\t\tconst resolved = await (mvrClient || getClient(buildOptions).core.mvr).resolve({\n\t\t\ttypes: names.types,\n\t\t\tpackages: names.packages,\n\t\t});\n\n\t\treplaceNames(transactionData, resolved);\n\n\t\tawait next();\n\t};\n};\n\nexport function getClient(options: BuildTransactionOptions) {\n\tif (!options.client) {\n\t\tthrow new Error(\n\t\t\t`No sui client passed to Transaction#build, but transaction data was not sufficient to build offline.`,\n\t\t);\n\t}\n\n\treturn options.client;\n}\n"],"mappings":"AAGA,SAASA,WAAA,QAAmB;AAC5B,SAASC,SAAA,QAAiB;AAG1B,SAASC,sBAAA,EAAwBC,YAAA,QAAoB;AAoCrD,MAAMC,QAAA,GAAW,mBAAIC,OAAA,CAA6B;AAgB3C,MAAMC,mBAAA,GAAuBC,OAAA,IAAyC;EAC5E,IAAIC,SAAA;EAEJ,IAAID,OAAA,EAAS;IACZ,MAAME,SAAA,GAAYF,OAAA,CAAQE,SAAA,IAAa;MACtCC,QAAA,EAAU,CAAC;MACXC,KAAA,EAAO,CAAC;IACT;IAEA,IAAI,CAACP,QAAA,CAASQ,GAAA,CAAIH,SAAS,GAAG;MAC7BL,QAAA,CAASS,GAAA,CAAIJ,SAAA,EAAW,IAAIT,WAAA,CAAY,CAAC;IAC1C;IAEAQ,SAAA,GAAY,IAAIP,SAAA,CAAU;MACzBa,KAAA,EAAOV,QAAA,CAASW,GAAA,CAAIN,SAAS;MAC7BO,GAAA,EAAKT,OAAA,CAAQS,GAAA;MACbC,QAAA,EAAUV,OAAA,CAAQU,QAAA;MAClBR;IACD,CAAC;EACF;EAEA,OAAO,OACNS,eAAA,EACAC,YAAA,EACAC,IAAA,KACI;IACJ,MAAMC,KAAA,GAAQnB,sBAAA,CAAuBgB,eAAe;IAEpD,IAAIG,KAAA,CAAMV,KAAA,CAAMW,MAAA,KAAW,KAAKD,KAAA,CAAMX,QAAA,CAASY,MAAA,KAAW,GAAG;MAC5D,OAAOF,IAAA,CAAK;IACb;IAEA,MAAMG,QAAA,GAAW,OAAOf,SAAA,IAAagB,SAAA,CAAUL,YAAY,EAAEM,IAAA,CAAKC,GAAA,EAAKC,OAAA,CAAQ;MAC9EhB,KAAA,EAAOU,KAAA,CAAMV,KAAA;MACbD,QAAA,EAAUW,KAAA,CAAMX;IACjB,CAAC;IAEDP,YAAA,CAAae,eAAA,EAAiBK,QAAQ;IAEtC,MAAMH,IAAA,CAAK;EACZ;AACD;AAEO,SAASI,UAAUjB,OAAA,EAAkC;EAC3D,IAAI,CAACA,OAAA,CAAQqB,MAAA,EAAQ;IACpB,MAAM,IAAIC,KAAA,CACT,sGACD;EACD;EAEA,OAAOtB,OAAA,CAAQqB,MAAA;AAChB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}